openapi: 3.0.4
info:
  title: Orders API
  description: API to handle and process orders, including status management and notification routing.
  version: 0.0.1-SNAPSHOT

servers:
  - url: http://localhost:8081
    description: Local development server

paths:
  /orders:
    get:
      summary: Returns a list of all orders.
      description: Get a list of all orders in the system. Typically used by admin dashboards.
      responses:
        "200":
          description: A JSON array of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderResponse'

    post:
      summary: Create a new order
      description: Initializes a new order in the system with a default status of CREATED.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        "201":
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "409":
          description: Conflicting Order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: "CONFLICT"
                message: "Order with order id orderId 5305b522-7fbb-4371-9fe3-bcf6d7f1c047 already exists."
                path: "/orders"
                timestamp: "2026-01-19T17:44:30Z"

  /orders/{id}:
    get:
      summary: Get an order by ID
      description: Returns a single order object based on the provided UUID.
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the order to retrieve
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Order found successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        "404":
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: "NOT_FOUND"
                message: "Order not found with id: 550e8400-e29b-41d4-a716-446655440000"
                path: "/orders/550e8400-e29b-41d4-a716-446655440000"
                timestamp: "2026-01-19T17:44:30Z"

    put:
      summary: Update order status
      description: >
        Updates the status of an existing order via a query parameter. 
        Triggers business validation and notification routing.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: true
          schema:
            type: string
            enum: [COMPLETED, CANCELLED]
      responses:
        "200":
          description: Status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        "400":
          description: Business rule violation or invalid transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidTransition:
                  summary: Invalid Status Transition
                  value:
                    status: "BAD_REQUEST"
                    message: "Cannot transition from COMPLETED to CANCELLED"
                    path: "/orders/550e8400-e29b-41d4-a716-446655440000"
                    timestamp: "2026-01-19T17:55:00Z"
        "404":
          description: Not Found - The resource or its required history was not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                orderMissing:
                  summary: Order Not Found
                  value:
                    status: "NOT_FOUND"
                    message: "Order with ID 123 not found"
                    path: "/orders/123"
                    timestamp: "2026-01-19T17:55:00Z"
                historyMissing:
                  summary: History Record Not Found
                  value:
                    status: "NOT_FOUND"
                    message: "No history found for order 123"
                    path: "/orders/123"
                    timestamp: "2026-01-19T17:55:00Z"

components:
  schemas:
    CreateOrderRequest:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          format: uuid
          example: "5305b522-7fbb-4371-9fe3-bcf6d7f1c047"
        name:
          type: string
          example: "Laptop"
    OrderResponse:
      type: object
      required:
        - id
        - name
        - history
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        currentStatus:
          $ref: '#/components/schemas/Status'
        history:
          type: array
          items:
            $ref: '#/components/schemas/OrderHistory'

    OrderHistory:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          $ref: '#/components/schemas/Status'
        timestamp:
          type: string
          format: date-time

    Status:
      type: string
      enum: [CREATED, COMPLETED, CANCELLED]

    ErrorResponse:
      type: object
      required:
        - status
        - message
        - path
        - timestamp
      properties:
        status:
          type: string
          example: "NOT_FOUND"
        message:
          type: string
          example: "Order not found"
        path:
          type: string
          example: "/orders/123"
        timestamp:
          type: string
          format: date-time
          example: "2026-01-19T17:44:30Z"